language: java
sudo: false
script: mvn clean install -B -V

matrix:
  include:
  - jdk: openjdk8
    after_success: mvn jacoco:report -pl "com.github.dynodao:dynodao-api,com.github.dynodao:dynodao-processor"
      -B && bash <(curl -s https://codecov.io/bash)

before_deploy:
- openssl aes-256-cbc -K $encrypted_ba2684aa2cfa_key -iv $encrypted_ba2684aa2cfa_iv
  -in .etc/signingkey.asc.enc -out .etc/signingkey.asc -d
- gpg2 --keyring=$TRAVIS_BUILD_DIR/pubring.gpg --no-default-keyring --import .etc/signingkey.asc
- gpg2 --allow-secret-key-import --keyring=$TRAVIS_BUILD_DIR/secring.gpg --no-default-keyring
  --import .etc/signingkey.asc

deploy:
  provider: script
  script: mvn -s .etc/travis.settings.xml -DskipTests=true -Dgpg.executable=gpg2 -Dgpg.keyname=A9C96D5B27E6390733A4DEF73ED8EF3F9F7CE8F2
    -Dgpg.passphrase=$PASSPHRASE -Dgpg.publicKeyring=$TRAVIS_BUILD_DIR/pubring.gpg
    -Dgpg.secretKeyring=$TRAVIS_BUILD_DIR/secring.gpg deploy -B -P release
  skip_cleanup: true
  on:
    branch: master
    repo: dynodao/dynodao

cache:
  directories:
  - "$HOME/.m2"

env:
  global:
  - secure: "cwTg3LP+yjxOVQvZZWnZZ1sDEYZGuIQhyuuoGkuaxib6zWdELP8hgKZ+NvFbhWRQFdaVb9chtLlKwnCXVF0izxchRYMNgG3yXxLnhfxt6n9r1JCAuvTWryDzi5AH06cEK7Z2u1RP5fY8rzulHcfYX7b+vV6BDO6UndBihgfRgYygRqYvkiOO1sEl7nAgtMz/T8Z/V7vKWpNgZWDuyH43FGfT4E5MhMWeUMfW1NqiGM64N6N4DFp9gnOayJF71SDC/8gYG7o1mzlVGbNckxIcdBN64eLysQtAI10HGNkHQUG9AHAT4pWLN+qPXLn7bRMOuSpc2FiYG6WIN9aYxuvQEJr4y9zk49vftKcu8K3p+r8x9NeJOKUQ9aTxmX5gBpC+jqutLXidEbGNeiC3hTzL8zqb3ZezfNQeenJGsEOauO+X3K/1XdngCBzJT+jtdjuQEi6Zr0Cnru+F8guZ7e99xCZrVoLJHSVj331HyM+raUbejZNrYPQrn8G8UDJ/qCDIAWfkSMJqPu2w3JEcSoC7sMshVgtZzJNqK+x9UJI54VK0434hmBR/aoqj6tlssTudjp3ocxg1R2w6wrBRkjqJnJtlgHc3jqvngB8kZPalVEjEg9+KKeYRfwFUG4H4kYQ6TjjusCq8w+9Xb22e+52jRKHWNNRLOMc5IinuwDHbt0g="
  - secure: "vkRmLaM6E7wlepuzu+MgZwvsmwSX0V0Ya0nEg5W5Tuda6sNokGJl/B1C1V44/lendOdRIfpZco3INNzoI18CoQTTmSUx05YFhysKJOLHvtOJDShAP6ya8IPYbY7a7oAYhd4GmOSIm3uBx/1kn+m10xKcVRLvsyn4d7Yee9TtHKNS0nyqow7PTcKBfN180oUZKwJxPJB7Vi1L8cCxD16Ky+yq+MmJn/0Ryli/8eS4JKRy0UwHenW+4qz/0qz0r/yS27Kx+05cFpYp0r2q4WMS+C+Pe8QZMiUfcrs3b29Rg2He/nyuqb0xCOy+ZtFPhpL+OyRII/jPYOaBrGUIvx7kwMbllxgNj38qbYtAgDo278o8qdzNTfY4e/63nTwUKhJVyNsLDA6I2dJyhxCy6BwTmRnl/2M/clKFoTvhmE+/S5zan+r1rpdaLld7Fd0BlLP4svfDCxt0wwpbBwXMgbVzL1DTj81EWJcRTiG7DhhPABaeUmUDy0e64tt/LExuLIg6uckKfbiYQtzksW0d6hPgJM5IRpBIgdJcDW9XOVJ2OtsxVhhQGFH9RqX6qOy47bp+cAY9qsGnEYl4hG65GP+rPRd7eOH+0qRTLb/zQHQ4bR4UzVXNQzuxaw1lfV9vgPnwBnW3HIK46R93tNR1KNvMbUlgxLGrCwEzb5LgAUuayjA="
  - secure: "oiRWlc6CkhAeo9hyysWQuS1nGXa06EKXJ+4cT6+TDQ5TGFHSQzeMP+Z5Awk8IecGVoa4OUJAy5BtRlb0wBJM9t4JplaGFBJjmcqN8FJodJovLXg7lMeR0boy0/uJpL+6G+HzBriRtwyJ14C54NN8y9IUGQeSaxE64HF93w6hPqJXnlMiEhslJhbsTuZeab7wyanMeoYYB0WWmQhJBt8eGcEDT2ytjJYWXJcsV69MxMGe817sGq1NWtuBNaR96eLd53vP2fHg0O/8u+37aDoPtpBRx956b7mPfkyJMw0quH8V3ZcbdqLs+dWgy7yeP6s608OIkNdb5RyaKNG8JH3SymujqJcxX5VLisn/cc//7hexUYO4mv1q/a8286b55OijWTzg9em83uU/Yje75ZhIqQTAcf/SIamWLkJ+Fsx7cpcg9yDh77j8TwvW9anPGMnP9TJVn5CsFAkL8Wd5Sw4KV77GMcf7W6Q3n+I+t5Eumv3kpN1YZq8g9rHiB/RJ0Tw7cdZpV9EgBekuat3UYFZh2wetOQoqEfD7mdFAg4UNmnsyi5/kUK/4i4fagmf7s3yh3mw85ncCU4DXPyOtVaOVA6AR7ceXalLEeQkIA/IriNkbV7sGStXTFFzcmt2YM4R6/bjQ9Ga9tLwNX6QJXlutfM99M3bJpcVqp36fnMBKfAY="
